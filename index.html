<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div id="out" class="center"></div>
	<script
	  src="https://code.jquery.com/jquery-3.2.1.min.js"
	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	  crossorigin="anonymous">
  </script>
	<script>
			(function app() {
				var output = document.getElementById('out');
				var apiKey = '65e1a3f7909bd8dd36e520691bc2f89c';

				if (!navigator.geolocation) {
					output.innerHTML = '<p>Geolocation is not supported by your browser</p>';
					return;
				}

				function sucess(position) {
					var latitude = position.coords.latitude;
					var longitude = position.coords.longitude;
					
					// Call the API
					$.getJSON(buildURL(latitude, longitude, apiKey), function(json) {

						var weatherApp = {
							'fahrenheit': convertKelvinsToFahrenheit(JSON.stringify(json.main.temp)),
							'celsius': convertKelvinToCelsius(JSON.stringify(json.main.temp))
						};

						window.weatherApp = weatherApp;


						// Paint here:

						// 1. create an <ul> with id="weather-list" and class="center"
						var weatherList = '<ul id="weather-list" class="center"></ul>';
						output.innerHTML = weatherList;

						// 2. create an <li> with the icon and append it to <ul>
						function createLiWithIcon(){
							var liElement = document.createElement('li');
							var imgElement = document.createElement('img');

							var weatherDesciption = JSON.stringify(json.weather[0].description);
							weatherDesciption = removeDoubleQuotes(weatherDesciption);

							imgElement.src = buildIconURL(weatherDesciption);

							weatherList = document.getElementById('weather-list');

							liElement.appendChild(imgElement);
							weatherList.appendChild(liElement);
						}

						createLiWithIcon();

						//3. create an <li> with the temperature and append it to <ul>
						function createLiWithTemp(){
							var liElement = document.createElement('li');
							var anchorElement = document.createElement('a');
							var temperature = convertKelvinToCelsius(JSON.stringify(json.main.temp)) + 'ÂºC';

							var textnode = document.createTextNode(temperature);
							anchorElement.appendChild(textnode);
							liElement.appendChild(anchorElement);
							weatherList.appendChild(liElement);
						}

						createLiWithTemp();

						// 4. create an <li> with the location and append it to <ul>
						function createLiWithLocation(){
							var liElement = document.createElement('li');
							var location = JSON.stringify(json.name);
							location = removeDoubleQuotes(location);

							var textnode = document.createTextNode(location);
							liElement.appendChild(textnode);
							weatherList.appendChild(liElement);
						}

						createLiWithLocation();

						// 5. create an <li> with the desciption and append it to <ul>
						function liWithDescription() {
							var liElement = document.createElement('li');
							var description = JSON.stringify(json.weather[0].description);
							description = removeDoubleQuotes(description);

							var textnode = document.createTextNode(description);
							liElement.appendChild(textnode);
							weatherList.appendChild(liElement);
						}

						liWithDescription();
					});
				}

				function error() {
					output.innerHTML = 'Unable to retrive your location';
				}

				// Build the URL
				function buildURL(latitude, longitude, apiKey) {
					var apiURL = 'http://api.openweathermap.org/data/2.5/weather?lat=' + latitude + '&lon=' + longitude + '&APPID=' + apiKey;
					console.log(apiURL);
			  	return apiURL;
				}

				// http://openweathermap.org/weather-conditions
				function buildIconURL(description) {
					var iconName;

					var icons = {
						'clear sky': '009-sun-1',
						'few clouds': '046-cloudy-day',
						'scattered clouds': '044-cloudy',
						'broken clouds': '044-cloudy',
						'overcast clouds': '044-cloudy',
						'shower rain': '023-rain-3',
						'light intensity drizzle': '023-rain-3',
						'drizzle': '023-rain-3',
						'heavy intensity drizzle': '023-rain-3',
						'light intensity drizzle rain': '023-rain-3',
						'drizzle rain': '023-rain-3',
						'heavy intensity drizzle rain': '023-rain-3',
						'shower rain and drizzle': '023-rain-3',
						'heavy shower rain and drizzle': '023-rain-3',
						'shower drizzle': '023-rain-3',
						'light intensity shower rain': '023-rain-3',
						'heavy intensity shower rain': '023-rain-3',
						'ragged shower rain': '023-rain-3',
						'rain': '022-rain-4',
						'light rain': '022-rain-4',
						'moderate rain': '022-rain-4',
						'heavy intensity rain': '022-rain-4',
						'very heavy rain': '022-rain-4',
						'extreme rain': '022-rain-4',
						'thunderstorm': '012-storm-1',
						'thunderstorm with light rain': '012-storm-1',
						'thunderstorm with rain': '012-storm-1',
						'thunderstorm with heavy rain': '012-storm-1',
						'light thunderstorm': '012-storm-1',
						'heavy thunderstorm': '012-storm-1',
						'ragged thunderstorm': '012-storm-1',
						'thunderstorm with light drizzle': '012-storm-1',
						'thunderstorm with drizzle': '012-storm-1',
						'thunderstorm with heavy drizzle': '012-storm-1',
						'snow': '014-snow-5',
						'freezing rain': '014-snow-5',
						'light snow': '014-snow-5',
						'heavy snow': '014-snow-5',
						'sleet': '014-snow-5',
						'shower sleet': '014-snow-5',
						'light rain and snow': '014-snow-5',
						'rain and snow': '014-snow-5',
						'light shower snow': '014-snow-5',
						'shower snow': '014-snow-5',
						'heavy shower snow': '014-snow-5',
						'mist': '040-foggy',
						'smoke': '040-foggy',
						'haze': '040-foggy',
						'sand, dust whirls': '040-foggy',
						'fog': '040-foggy',
						'sand': '040-foggy',
						'dust': '040-foggy',
						'volcanic ash': '040-foggy',
						'squalls': '040-foggy',
						'tornado': '040-foggy'
					};

					for (var prop in icons) {
						if (icons.hasOwnProperty(description)) {
							iconName = (icons[description]);
							return 'assets/icons/png/' + iconName + '.png';
						}
					}
				}

				function convertKelvinToCelsius(kelvin) {
					var celsius = kelvin - 273;
					return Math.round(celsius);
				}

				function convertKelvinsToFahrenheit(kelvin) {
					var fahrenheit = kelvin * 9 / 5 - 459.67;
					return Math.round(fahrenheit);
				}

				function removeDoubleQuotes(data) {
					if (typeof data === 'string') {
						return data.replace(/\"/g, "");
					}
					return data;
				}

				// function toggleTempScales() {
				// 	var temperature = document.getElementById();
				// 	addEventLister();
				// }

				output.innerHTML = '<p>Locating...</p>';
				// Get the location
				navigator.geolocation.getCurrentPosition(sucess, error);
		})();
	</script>
</body>
</html>