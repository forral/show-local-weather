<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>

		body {
			background-color: grey;
		}

		.center {
			text-align: center;
			width: 500px;
			margin: 50px auto;
		}

	</style>
</head>
<body>
	<div id="out" class="center"></div>
	<div>
		<ul id="weather-list" class="center"></ul>
	</div>
	<script
	  src="https://code.jquery.com/jquery-3.2.1.min.js"
	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	  crossorigin="anonymous">
  </script>
	<script>
			(function app() {
				var output = document.getElementById('out');
				var apiKey = '65e1a3f7909bd8dd36e520691bc2f89c';

				if (!navigator.geolocation) {
					output.innerHTML = '<p>Geolocation is not supported by your browser</p>';
					return;
				}

				function sucess(position) {
					latitude = position.coords.latitude;
					longitude = position.coords.longitude;
					
					// Call the API
					$.getJSON(buildURL(latitude, longitude, apiKey), function(json) {

						// Paint here:

						function createLi(data){
							var list = document.getElementById('weather-list');
							var node = document.createElement('li');
							var textnode = document.createTextNode(data);
							node.appendChild(textnode);
							list.appendChild(node);
						}

						createLi(JSON.stringify(json.name));
						createLi(convertKelvinToCelsius(JSON.stringify(json.main.temp)));
						createLi(JSON.stringify(json.weather[0].description));
					});
				}

				function error() {
					output.innerHTML = 'Unable to retrive your location';
				}

				function convertKelvinToCelsius(kelvin) {
					var celsius = kelvin - 273;
					return Math.round(celsius);
				}

				// Build the URL
				function buildURL(latitude, longitude, apiKey) {
					var apiURL = 'http://api.openweathermap.org/data/2.5/weather?lat=' + latitude + '&lon=' + longitude + '&APPID=' + apiKey;
					console.log(apiURL);
			  	return apiURL;
				}

				output.innerHTML = '<p>Locating...</p>';

				// Get the location
				navigator.geolocation.getCurrentPosition(sucess, error);
		})();






	
	

	</script>
</body>
</html>